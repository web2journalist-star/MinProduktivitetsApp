<!doctype html>
<html lang="da">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MinProduktivitetsApp</title>
    <meta
      name="description"
      content="MinProduktivitetsApp: lokal-first produktivitetsapp med Neon (Postgres) + lokal LLM (Ollama)."
    />
    <style>
      :root {
        --bg: #0b1020;
        --text: #e8eeff;
        --muted: #a9b5d3;
        --accent: #7c5cff;
        --accent2: #2ee59d;
        --border: rgba(255, 255, 255, 0.08);
        --cardbg: rgba(255, 255, 255, 0.04);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica,
          Arial, "Apple Color Emoji", "Segoe UI Emoji";
        background: radial-gradient(1200px 700px at 20% 0%, rgba(124, 92, 255, 0.35), transparent 60%),
          radial-gradient(900px 600px at 80% 10%, rgba(46, 229, 157, 0.18), transparent 55%),
          var(--bg);
        color: var(--text);
        line-height: 1.5;
      }

      a {
        color: inherit;
      }

      .wrap {
        max-width: 980px;
        margin: 0 auto;
        padding: 48px 18px;
      }

      header {
        display: flex;
        justify-content: space-between;
        gap: 12px;
        align-items: baseline;
        margin-bottom: 18px;
      }

      .greeting {
        margin: 0;
        font-size: 18px;
        color: var(--muted);
      }

      .date {
        margin: 0;
        font-size: 13px;
        color: var(--muted);
      }

      .grid {
        display: grid;
        grid-template-columns: 1.1fr 0.9fr;
        gap: 18px;
        align-items: start;
      }

      @media (max-width: 900px) {
        .grid {
          grid-template-columns: 1fr;
        }
      }

      .card {
        border: 1px solid var(--border);
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
        border-radius: 18px;
        padding: 22px;
        backdrop-filter: blur(10px);
        box-shadow:
          0 12px 40px rgba(0, 0, 0, 0.35),
          inset 0 1px 0 rgba(255, 255, 255, 0.08);
      }

      .card.accent {
        border-color: rgba(124, 92, 255, 0.42);
      }

      .card.accent2 {
        border-color: rgba(46, 229, 157, 0.35);
      }

      h1 {
        margin: 0;
        font-size: 28px;
        letter-spacing: -0.02em;
      }

      h2 {
        margin: 0 0 10px;
        font-size: 15px;
      }

      p {
        margin: 10px 0 0;
        color: var(--muted);
        font-size: 14px;
      }

      .row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .btn {
        appearance: none;
        border-radius: 12px;
        padding: 10px 12px;
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.04);
        color: var(--text);
        cursor: pointer;
        font: inherit;
      }

      .btn.primary {
        border-color: rgba(124, 92, 255, 0.6);
        background: rgba(124, 92, 255, 0.18);
      }

      .btn.good {
        border-color: rgba(46, 229, 157, 0.6);
        background: rgba(46, 229, 157, 0.16);
      }

      .btn.ghost {
        background: transparent;
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .input {
        width: 100%;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: rgba(0, 0, 0, 0.25);
        color: var(--text);
        padding: 10px 12px;
        font: inherit;
      }

      .muted {
        color: var(--muted);
      }

      .list {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .list li {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
        padding: 10px 10px;
        border: 1px solid var(--border);
        background: var(--cardbg);
        border-radius: 12px;
        margin-top: 10px;
      }

      .list li:hover {
        border-color: rgba(255, 255, 255, 0.16);
      }

      .list li .text {
        min-width: 0;
        flex: 1;
        word-break: break-word;
      }

      .badge {
        display: inline-block;
        font-size: 12px;
        padding: 3px 10px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.04);
        color: var(--muted);
      }

      .timer {
        display: grid;
        gap: 10px;
      }

      .timerbox {
        border: 1px solid var(--border);
        background: rgba(0, 0, 0, 0.22);
        border-radius: 14px;
        padding: 12px;
      }

      .timerdisplay {
        font-size: 26px;
        font-weight: 700;
        letter-spacing: 0.02em;
      }

      .bar {
        height: 10px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.08);
        overflow: hidden;
        margin-top: 10px;
      }

      .bar > div {
        height: 100%;
        width: 0%;
        background: var(--accent2);
        transition: width 0.2s ease;
      }

      .overlay {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.35);
        backdrop-filter: blur(6px);
        z-index: 50;
      }

      .overlay.show {
        display: flex;
      }

      .countdown {
        width: min(520px, 92vw);
        border-radius: 22px;
        border: 1px solid rgba(255, 255, 255, 0.16);
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.10), rgba(255, 255, 255, 0.04));
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.45);
        padding: 24px;
        text-align: center;
      }

      .countdownNum {
        font-size: 74px;
        font-weight: 800;
        letter-spacing: -0.03em;
        margin: 6px 0;
      }

      .countdownSmall {
        margin: 0;
        font-size: 14px;
        color: var(--muted);
      }

      canvas#confetti {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 60;
      }

      .split {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }

      @media (max-width: 900px) {
        .split {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div>
          <div class="badge">v0 (static demo)</div>
          <h1>MinProduktivitetsApp</h1>
          <p class="greeting" id="greeting">Goddag</p>
        </div>
        <p class="date" id="date"></p>
      </header>

      <div class="grid">
        <div class="card accent">
          <h2>Dagens Fokus Trio</h2>
          <p>Klik på en linje for at redigere. Gemmes lokalt i din browser (så du ser dem igen ved refresh).</p>

          <ul class="list" id="focus-list"></ul>

          <div style="margin-top: 12px" class="row">
            <button class="btn ghost" id="focus-reset">Nulstil</button>
          </div>

          <div style="margin-top: 18px" class="split">
            <div>
              <h2>Min To-Do (lokal v0)</h2>
              <p>Tilføj opgaver. Markér færdig for at flytte til Ta-Da.</p>

              <div class="row" style="margin-top: 10px">
                <input class="input" id="todo-input" placeholder="Tilføj en opgave..." />
                <button class="btn primary" id="todo-add">Tilføj</button>
              </div>

              <ul class="list" id="todo-list"></ul>
            </div>

            <div>
              <h2>Ta-Da (fuldført i dag)</h2>
              <p>Små sejre tæller. Skriv direkte herunder, eller flyt en To-Do til Ta-Da. Gemmes lokalt.</p>
              <div class="row" style="margin-top: 10px">
                <input class="input" id="tada-input" placeholder="Tilføj en Ta-Da succes..." />
                <button class="btn good" id="tada-add">Tilføj</button>
              </div>
              <ul class="list" id="tada-list"></ul>
            </div>
          </div>
        </div>

        <div class="card accent2">
          <h2>Tidsblok</h2>
          <p>Vælg en blok. Start/stop fungerer i fanen (ingen push-notifications endnu).</p>

          <div class="timer">
            <div class="row">
              <button class="btn" data-seconds="600" data-label="10 min Fokus">10m Fokus</button>
              <button class="btn" data-seconds="1500" data-label="25 min Pomodoro">25m Pomodoro</button>
              <button class="btn" data-seconds="3000" data-label="50 min Dybde">50m Dybde</button>
              <button class="btn" data-seconds="600" data-label="10 min Pause">10m Pause</button>
            </div>

            <div class="timerbox">
              <div class="muted" id="timer-label">Vælg blok…</div>
              <div class="timerdisplay" id="timer-display">00:00</div>
              <div class="bar"><div id="timer-bar"></div></div>
            </div>

            <div class="row">
              <button class="btn primary" id="timer-start" disabled>Start</button>
              <button class="btn" id="timer-reset" disabled>Nulstil</button>
            </div>
          </div>

          <div style="margin-top: 18px">
            <h2>"Hvis jeg kun har 1 time" (online v0)</h2>
            <p>
              LLM-planlægning kører lokalt lige nu (Ollama). Den næste online iteration er enten:
              (a) en lille API der læser fra Neon, eller (b) cloud-LLM.
            </p>
            <div class="row" style="margin-top: 10px">
              <a class="btn primary" href="https://vercel.com/new" target="_blank" rel="noreferrer">Deploy på Vercel</a>
              <a class="btn" href="https://github.com/web2journalist-star/MinProduktivitetsApp" target="_blank" rel="noreferrer">Repo på GitHub</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="overlay" id="celebrate-overlay" aria-hidden="true">
      <div class="countdown">
        <div class="badge">Fejring</div>
        <div class="countdownNum" id="countdown-num">3</div>
        <p class="countdownSmall">3210… konfetti</p>
      </div>
    </div>
    <canvas id="confetti"></canvas>

    <script>
      const STORAGE = {
        focus: 'mp_focus_trio_v0',
        todos: 'mp_todos_v0',
        tadas: 'mp_tadas_v0',
      };

      function fmtDate(now) {
        return now.toLocaleDateString('da-DK', { weekday: 'long', day: 'numeric', month: 'long' });
      }

      function greeting(now) {
        const h = now.getHours();
        if (h < 5 || h >= 22) return 'Godnat';
        if (h < 10) return 'Godmorgen';
        if (h < 14) return 'Goddag';
        if (h < 18) return 'Godeftermiddag';
        return 'Godaften';
      }

      function loadJSON(key, fallback) {
        try {
          const raw = localStorage.getItem(key);
          return raw ? JSON.parse(raw) : fallback;
        } catch {
          return fallback;
        }
      }

      function saveJSON(key, value) {
        localStorage.setItem(key, JSON.stringify(value));
      }

      function uid() {
        return Math.random().toString(16).slice(2) + Date.now().toString(16);
      }

      let audioCtx = null;

      function ensureAudio() {
        if (!audioCtx) {
          const Ctx = window.AudioContext || window.webkitAudioContext;
          if (Ctx) audioCtx = new Ctx();
        }
        if (audioCtx && audioCtx.state === 'suspended') {
          audioCtx.resume();
        }
      }

      function tone(freq, durationMs, type, gainValue) {
        ensureAudio();
        if (!audioCtx) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.value = freq;
        gain.gain.value = 0.0001;
        osc.connect(gain);
        gain.connect(audioCtx.destination);

        const now = audioCtx.currentTime;
        gain.gain.setValueAtTime(0.0001, now);
        gain.gain.exponentialRampToValueAtTime(gainValue, now + 0.01);
        gain.gain.exponentialRampToValueAtTime(0.0001, now + durationMs / 1000);

        osc.start(now);
        osc.stop(now + durationMs / 1000 + 0.02);
      }

      function sfxClick() {
        tone(520, 60, 'square', 0.06);
      }

      function sfxSuccess() {
        tone(523.25, 80, 'sine', 0.07);
        setTimeout(() => tone(659.25, 90, 'sine', 0.07), 90);
        setTimeout(() => tone(783.99, 110, 'sine', 0.07), 200);
      }

      function sfxCountdown(n) {
        const base = 240 + n * 80;
        tone(base, 90, 'triangle', 0.06);
      }

      const focusDefaults = [
        'Prioritet 1: [Klik for at skrive]',
        'Prioritet 2: [Klik for at skrive]',
        'Prioritet 3: [Klik for at skrive]',
      ];

      function renderFocus() {
        const ul = document.getElementById('focus-list');
        const items = loadJSON(STORAGE.focus, focusDefaults);
        ul.innerHTML = '';
        items.forEach((text, idx) => {
          const li = document.createElement('li');
          const span = document.createElement('div');
          span.className = 'text';
          span.textContent = text;
          span.style.cursor = 'text';
          span.addEventListener('click', () => {
            const input = document.createElement('input');
            input.className = 'input';
            input.value = text;
            input.addEventListener('blur', () => {
              const next = input.value.trim() || focusDefaults[idx];
              const updated = loadJSON(STORAGE.focus, focusDefaults);
              updated[idx] = next;
              saveJSON(STORAGE.focus, updated);
              renderFocus();
            });
            input.addEventListener('keydown', (e) => {
              if (e.key === 'Enter') input.blur();
            });
            li.replaceChild(input, span);
            input.focus();
          });
          li.appendChild(span);
          ul.appendChild(li);
        });
      }

      function addTada(text) {
        const t = String(text || '').trim();
        if (!t) return;
        const tadas = loadJSON(STORAGE.tadas, []);
        tadas.unshift({ id: uid(), text: t, at: new Date().toISOString() });
        saveJSON(STORAGE.tadas, tadas);
        renderTadas();
        celebrate();
      }

      let confetti = {
        running: false,
        particles: [],
        raf: null,
      };

      function confettiStart(durationMs) {
        const canvas = document.getElementById('confetti');
        const ctx = canvas.getContext('2d');
        const dpr = window.devicePixelRatio || 1;

        function resize() {
          canvas.width = Math.floor(window.innerWidth * dpr);
          canvas.height = Math.floor(window.innerHeight * dpr);
          canvas.style.width = window.innerWidth + 'px';
          canvas.style.height = window.innerHeight + 'px';
          ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        }

        resize();
        window.addEventListener('resize', resize, { passive: true });

        const colors = ['#7c5cff', '#2ee59d', '#ffd166', '#ff6b6b', '#4cc9f0'];
        const count = 180;
        confetti.particles = Array.from({ length: count }).map(() => ({
          x: window.innerWidth * Math.random(),
          y: -20 - Math.random() * window.innerHeight * 0.2,
          w: 6 + Math.random() * 6,
          h: 6 + Math.random() * 10,
          vx: -2 + Math.random() * 4,
          vy: 2 + Math.random() * 5,
          rot: Math.random() * Math.PI,
          vr: -0.2 + Math.random() * 0.4,
          color: colors[Math.floor(Math.random() * colors.length)],
          alpha: 0.9,
        }));

        const start = performance.now();
        confetti.running = true;

        function step(now) {
          ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);
          confetti.particles.forEach((p) => {
            p.vy += 0.03;
            p.x += p.vx;
            p.y += p.vy;
            p.rot += p.vr;
            if (p.y > window.innerHeight + 40) {
              p.y = -30;
              p.x = window.innerWidth * Math.random();
              p.vy = 2 + Math.random() * 5;
            }
            ctx.save();
            ctx.globalAlpha = p.alpha;
            ctx.translate(p.x, p.y);
            ctx.rotate(p.rot);
            ctx.fillStyle = p.color;
            ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
            ctx.restore();
          });

          if (now - start < durationMs) {
            confetti.raf = requestAnimationFrame(step);
          } else {
            confettiStop();
          }
        }

        confetti.raf = requestAnimationFrame(step);
      }

      function confettiStop() {
        confetti.running = false;
        if (confetti.raf) cancelAnimationFrame(confetti.raf);
        confetti.raf = null;
        const canvas = document.getElementById('confetti');
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }

      async function celebrate() {
        const overlay = document.getElementById('celebrate-overlay');
        const num = document.getElementById('countdown-num');
        if (!overlay || !num) return;
        if (overlay.classList.contains('show')) return;

        overlay.classList.add('show');
        overlay.setAttribute('aria-hidden', 'false');

        for (let n = 3; n >= 0; n--) {
          num.textContent = String(n);
          if (n > 0) sfxCountdown(n);
          await new Promise((r) => setTimeout(r, 420));
        }

        overlay.classList.remove('show');
        overlay.setAttribute('aria-hidden', 'true');

        sfxSuccess();
        confettiStart(1400);
        setTimeout(confettiStop, 1600);
      }

      function renderTodos() {
        const ul = document.getElementById('todo-list');
        const items = loadJSON(STORAGE.todos, []);
        ul.innerHTML = '';
        items.forEach((t) => {
          const li = document.createElement('li');
          const text = document.createElement('div');
          text.className = 'text';
          text.textContent = t.text;

          const actions = document.createElement('div');
          actions.className = 'row';

          const done = document.createElement('button');
          done.className = 'btn primary';
          done.textContent = 'Færdig';
          done.addEventListener('click', () => {
            const todos = loadJSON(STORAGE.todos, []);
            const remaining = todos.filter((x) => x.id !== t.id);
            saveJSON(STORAGE.todos, remaining);

            const tadas = loadJSON(STORAGE.tadas, []);
            tadas.unshift({ id: uid(), text: t.text, at: new Date().toISOString() });
            saveJSON(STORAGE.tadas, tadas);
            renderTodos();
            renderTadas();
            celebrate();
          });

          const del = document.createElement('button');
          del.className = 'btn';
          del.textContent = 'Slet';
          del.addEventListener('click', () => {
            const todos = loadJSON(STORAGE.todos, []);
            saveJSON(
              STORAGE.todos,
              todos.filter((x) => x.id !== t.id)
            );
            renderTodos();
          });

          actions.appendChild(done);
          actions.appendChild(del);
          li.appendChild(text);
          li.appendChild(actions);
          ul.appendChild(li);
        });
      }

      function renderTadas() {
        const ul = document.getElementById('tada-list');
        const items = loadJSON(STORAGE.tadas, []);
        ul.innerHTML = '';
        items.forEach((t) => {
          const li = document.createElement('li');
          const text = document.createElement('div');
          text.className = 'text';
          text.textContent = t.text;

          const del = document.createElement('button');
          del.className = 'btn';
          del.textContent = 'Fjern';
          del.addEventListener('click', () => {
            const tadas = loadJSON(STORAGE.tadas, []);
            saveJSON(
              STORAGE.tadas,
              tadas.filter((x) => x.id !== t.id)
            );
            renderTadas();
          });

          li.appendChild(text);
          li.appendChild(del);
          ul.appendChild(li);
        });
      }

      let timer = {
        interval: null,
        selectedSeconds: 0,
        remainingSeconds: 0,
        label: 'Vælg blok…',
      };

      function formatMMSS(totalSeconds) {
        const m = Math.floor(totalSeconds / 60);
        const s = totalSeconds % 60;
        return `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
      }

      function renderTimer() {
        document.getElementById('timer-label').textContent = timer.label;
        document.getElementById('timer-display').textContent = formatMMSS(timer.remainingSeconds);
        const pct =
          timer.selectedSeconds > 0
            ? ((timer.selectedSeconds - timer.remainingSeconds) / timer.selectedSeconds) * 100
            : 0;
        document.getElementById('timer-bar').style.width = `${Math.max(0, Math.min(100, pct))}%`;

        document.getElementById('timer-start').disabled = timer.selectedSeconds <= 0;
        document.getElementById('timer-reset').disabled = timer.selectedSeconds <= 0;
      }

      function stopTimer() {
        if (timer.interval) {
          clearInterval(timer.interval);
          timer.interval = null;
        }
      }

      function startTimer() {
        if (timer.interval || timer.remainingSeconds <= 0) return;
        const startBtn = document.getElementById('timer-start');
        startBtn.textContent = 'Kører…';
        startBtn.disabled = true;

        timer.interval = setInterval(() => {
          timer.remainingSeconds -= 1;
          if (timer.remainingSeconds <= 0) {
            stopTimer();
            timer.remainingSeconds = 0;
            document.getElementById('timer-start').textContent = 'Start';
            renderTimer();
            alert('Tidsblokken er færdig.');
            return;
          }
          renderTimer();
        }, 1000);
      }

      function resetTimer() {
        stopTimer();
        timer.remainingSeconds = timer.selectedSeconds;
        document.getElementById('timer-start').textContent = 'Start';
        renderTimer();
      }

      document.addEventListener('DOMContentLoaded', () => {
        const now = new Date();
        document.getElementById('greeting').textContent = `${greeting(now)}`;
        document.getElementById('date').textContent = fmtDate(now);

        renderFocus();
        renderTodos();
        renderTadas();
        renderTimer();

        document.getElementById('focus-reset').addEventListener('click', () => {
          saveJSON(STORAGE.focus, focusDefaults);
          renderFocus();
        });

        document.getElementById('todo-add').addEventListener('click', () => {
          sfxClick();
          const input = document.getElementById('todo-input');
          const text = input.value.trim();
          if (!text) return;
          const todos = loadJSON(STORAGE.todos, []);
          todos.unshift({ id: uid(), text, at: new Date().toISOString() });
          saveJSON(STORAGE.todos, todos);
          input.value = '';
          renderTodos();
        });

        document.getElementById('tada-add').addEventListener('click', () => {
          sfxClick();
          const input = document.getElementById('tada-input');
          const text = input.value;
          input.value = '';
          addTada(text);
        });

        document.getElementById('tada-input').addEventListener('keydown', (e) => {
          if (e.key === 'Enter') document.getElementById('tada-add').click();
        });

        document.getElementById('todo-input').addEventListener('keydown', (e) => {
          if (e.key === 'Enter') document.getElementById('todo-add').click();
        });

        document.querySelectorAll('button[data-seconds]').forEach((btn) => {
          btn.addEventListener('click', () => {
            sfxClick();
            stopTimer();
            const secs = Number(btn.getAttribute('data-seconds'));
            const label = String(btn.getAttribute('data-label') || 'Tidsblok');
            timer.selectedSeconds = secs;
            timer.remainingSeconds = secs;
            timer.label = label;
            document.getElementById('timer-start').textContent = 'Start';
            renderTimer();
          });
        });

        document.getElementById('timer-start').addEventListener('click', () => {
          sfxClick();
          startTimer();
        });
        document.getElementById('timer-reset').addEventListener('click', () => {
          sfxClick();
          resetTimer();
        });

        document.body.addEventListener('pointerdown', () => {
          ensureAudio();
        }, { once: true });
      });
    </script>
  </body>
</html>
